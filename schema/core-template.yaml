schema_version: "AA-Trigger-Core-0.1.2"

# REQUIRED: language of this file
language: "en"  # ISO 639-1 code

# REQUIRED: unique identifier for this trigger set
trigger_set_id: "TEMPLATE_TRIGGER_SET_ID"

# REQUIRED: short human name for the trigger set
name: "Template – HAZARD / COUNTRY / AREA"

# REQUIRED: type of originating document
# e.g. "EAP", "sEAP", "AAP", "AAF, SOP", "contingency_plan"
document_type: "AAP"

# REQUIRED: provenance of the human document
source:
  document_title: "..."
  implementing_org: "..."    # main organisation responsible (e.g. "Nepal Red Cross Society")
  countries: []              # ISO 3166-1 alpha-2, e.g. ["NP"]
  year: 2024
  document_language: "en"
  document_download_url: ""  # direct or best-available link to the PDF/DOC
  aa_scheme: "RCRC_DREF"     # e.g. "RCRC_DREF", "CERF_AA", "START_READY", "WAHAFA", "GOV_AA", "OTHER"
  section_reference: ""      # where the trigger text is in the document
  accessed_date: "YYYY-MM-DD"
  original_document_type: "" # free text if needed (e.g. "Simplified Early Action Protocol")

# OPTIONAL BUT RECOMMENDED WHEN RELEVANT:
# Minimal catalogue of data sources used by indicators.
data_sources:
  - id: "DATA_SOURCE_ID"
    name: "Short name of the data source"         # e.g. "Global Flood Awareness System"
    provider: "Owning agency or system"           # e.g. "ECMWF", "DHM"
    type: "forecast"                              # observation | forecast | model | index | manual | other
    url: "https://example.org/path"

# OPTIONAL BUT RECOMMENDED WHEN RELEVANT:
# Catalogue of spatial objects (stations, basins, areas, etc.) where triggers apply.
spatial_conditions:
  - id: "SPATIAL_CONDITION_ID"
    label: "Karnali River at Chisapani gauge"
    feature_type: "station"                       # station | basin | area | grid_cell | other
    station:
      provider: "DHM"
      station_name: "Chisapani"
      station_type: "river_gauge"
      river_name: "Karnali"
      country: "NP"
    # geometry, basin, admin_areas etc. can be added as per SCHEMA_EXTENSIONS.md if available.

# =========================
# CORE: phases & indicators
# =========================

phases:
  - phase_id: "PHASE_1_ID"       # REQUIRED: machine ID, used in systems
    phase_name: "Readiness"      # REQUIRED: human-readable name
    phase_type: "readiness"      # REQUIRED: "readiness" | "activation" | "scale_up" | "deactivation"
    sequence: 1                  # REQUIRED: integer ordering of phases

    # REQUIRED: lead time for this phase as a whole.
    # Use hours by default; days are optional if the plan uses them explicitly.
    lead_time:
      min_hours: 72
      max_hours: 120
      min_days: null
      max_days: null

    # OPTIONAL: IDs of spatial_conditions describing where this phase applies
    # (e.g. target river basins, districts). This is about *where the trigger is relevant*,
    # not necessarily where each indicator is measured.
    applies_to_spatial_condition_ids: []  # e.g. ["area_western_terai"]

    # REQUIRED: exact or very close trigger paragraph(s) for this phase from the document.
    source_trigger_text: |-
      Paste the exact readiness trigger statement for this phase here.

    # REQUIRED: indicators that appear in the trigger logic.
    # Keep these as compact as possible while still encoding all semantics.
    indicators:
      - id: "INDICATOR_1_ID"     # REQUIRED: unique within this trigger set
        data_source_id: "DATA_SOURCE_ID"      # REQUIRED: link to data_sources entry
        spatial_condition_id: "SPATIAL_CONDITION_ID"   # REQUIRED where location is specified
        variable: "river_stage"               # REQUIRED: name used in the data system
        metric_type: "value"                  # REQUIRED: value | probability | boolean | category | index | manual
        unit: "m"                             # REQUIRED for numeric metrics; null/empty for boolean/category

        # OPTIONAL: override phase-level lead time if this indicator uses a different horizon.
        # Omit if same as the phase.
        # lead_time:
        #   min_hours: 48
        #   max_hours: 48

        # REQUIRED: the threshold condition for this indicator
        condition:
          operator: ">="                      # >= | > | <= | < | == | != | in | not_in
          value: 11.8                         # number or string or list, depending on metric_type

          # OPTIONAL: encode semantics like “1 m above danger level”.
          reference_value_type: "relative_to_reference"  # absolute | relative_to_reference
          reference_name: "danger_level"      # e.g. danger_level, warning_level
          reference_offset:
            value: 1.0                        # e.g. 1.0 m above reference
            unit: "m"

          # OPTIONAL (see SCHEMA_EXTENSIONS.md):
          # spatial_condition:                 # for "CDI >= 70 in at least 3 districts" cases
          #   metric: "admin_units_meeting_threshold"
          #   admin_level: "district"
          #   operator: ">="
          #   value: 3

    # REQUIRED: machine-readable logic over indicator IDs.
    trigger_logic:
      boolean_expression: "INDICATOR_1_ID AND INDICATOR_2_ID"
      # The boolean_expression is a simple infix expression over indicator IDs
      # using AND, OR, NOT and parentheses.
      # Example: "i_glofas_karnali OR (i_nwp_babai AND i_stagegap_babai)"

    # OPTIONAL: stop / deactivation logic for the phase once it has fired.
    # Useful for things like "evacuation only when rivers are above danger level and rising".
    # stop_logic:
    #   boolean_expression: "NOT INDICATOR_3_ID"