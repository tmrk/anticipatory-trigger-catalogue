schema_version: "AA-Trigger-Core-0.1.1"

# REQUIRED: language of this file
language: "en"  # ISO 639-1 code

# REQUIRED: unique identifier for this trigger set
trigger_set_id: "TEMPLATE_TRIGGER_SET_ID"

# REQUIRED: short human name for the trigger set
name: "Template – HAZARD / COUNTRY / AREA"

# REQUIRED: type of originating document
# e.g. "EAP", "sEAP", "AAP", "AAF, SOP", "contingency_plan"
document_type: "AAP"

# REQUIRED: provenance of the human document
source:
  document_title: "..."
  organisations: []          # e.g. ["Nepal Red Cross Society", "IFRC"]
  countries: []              # ISO 3166-1 alpha-2, e.g. ["NP"]
  year: 2024
  document_language: "en"
  document_download_url: ""
  document_landing_page_url: ""
  section_reference: ""      # where the trigger text is in the document
  accessed_date: "YYYY-MM-DD"
  original_document_type: "" # free text if needed

# OPTIONAL: see SCHEMA_EXTENSIONS for extra sections such as:
# - metadata
# - data_sources
# - spatial_conditions
# - indicator_catalog
# They can be added as top-level keys next to `phases`.

# =========================
# CORE: phases & indicators
# =========================

phases:
  - phase_id: "PHASE_1_ID"       # REQUIRED: machine ID, used in systems
    phase_name: "Readiness"      # REQUIRED: human-readable name
    phase_type: "readiness"      # REQUIRED: "readiness" | "activation" | "scale_up" | "deactivation"
    sequence: 1                  # REQUIRED: integer ordering of phases

    # REQUIRED: lead time for this phase as a whole.
    lead_time:
      min_hours: 48
      max_hours: 72
      min_days: 2
      max_days: 3

    # OPTIONAL: IDs of spatial_conditions describing where this phase applies
    # (e.g. target river basins, districts). This is about *where the trigger is relevant*,
    # not necessarily where each indicator is measured.
    applies_to_spatial_condition_ids: []  # e.g. ["area_western_terai"]

    # REQUIRED: exact human trigger paragraph(s) from the document
    source_trigger_text: |-
      Paste the exact trigger paragraph(s) for this phase here.

    # REQUIRED: indicators that appear in the trigger logic
    indicators:
      - id: "INDICATOR_1_ID"   # REQUIRED: unique within this trigger set
        label: "Short label for UIs and auto-text"
        description: "Longer human description of what is being measured."

        # OPTIONAL: semantic classification
        # (helps with auto-text like “hazard indicator” vs “impact indicator”)
        role: "hazard"         # "hazard" | "exposure" | "vulnerability" | "impact" | "operational"

        # OPTIONAL: reference to the data source providing this indicator
        # (see `data_sources` extension)
        data_source_id: "DATA_SOURCE_ID"

        # OPTIONAL BUT IMPORTANT: where this indicator is measured / applies.
        # For gauge- or grid-based indicators, point this at a spatial_conditions
        # entry of feature_type: "station" or "grid_cell".
        spatial_condition_id: "SPATIAL_CONDITION_ID"

        # OPTIONAL: name of the variable in the data system (API / column name / etc.)
        variable: "river_stage"   # e.g. river_stage, discharge, q2_return_period

        # REQUIRED: how to interpret the metric
        metric_type: "value"      # "value" | "probability" | "boolean" | "category"
        unit: "m"                 # null for boolean / non-numeric

        # OPTIONAL: override phase-level lead time if needed
        lead_time:
          min_hours: 48
          max_hours: 48

        # OPTIONAL: aggregation rules for data cubes (forecasts, grids, etc.)
        aggregation:
          temporal: "max"         # "max" | "min" | "mean" | "sum" | "any" | "all" | "none"
          spatial: "point"        # "point" | "basin_average" | "district_total" | "none"

        # REQUIRED: the threshold condition for this indicator
        condition:
          operator: ">="          # ">= | > | <= | < | == | != | in | not_in"
          value: 11.8             # number or string or list, depending on metric_type

          # OPTIONAL: extra semantics so a machine can reproduce phrases like
          # “1 m above the danger level” instead of just “11.8 m”.
          reference_value_type: "absolute"    # "absolute" | "relative_to_reference"
          reference_name: "danger_level"      # e.g. "danger_level", "warning_level"
          reference_offset:
            value: 1.0                        # e.g. 1.0 m above reference
            unit: "m"

    # REQUIRED: machine-readable logic over indicator IDs.
    # This is the *minimal* thing an engine needs to know how to fire the trigger.
    trigger_logic:
      boolean_expression: "INDICATOR_1_ID AND INDICATOR_2_ID"
      # The boolean_expression is a simple infix expression over indicator IDs
      # using operators AND, OR, NOT and parentheses.

      # OPTIONAL: free-text explanation of the logic. This can be re-generated
      # from boolean_expression + indicator labels, but keeping it helps traceability.
      explanation: >-
        Short free-text explanation of how indicators combine for this phase.

    # OPTIONAL: stop / deactivation logic for the phase once it has fired
    stop_logic:
      boolean_expression: "NOT INDICATOR_3_ID"
      explanation: >-
        Optional logic that defines when actions linked to this phase should be
        paused or cancelled (e.g. “evacuation stops once gauges fall below
        danger level or start to drop”).
